<h1><center>一卡通管理系统软件使用说明书</center></h1>

# 0 说明

本软件在 Windows 环境中运行，需要通过 USB 串口连接读卡器，对基于 ISO/IEC15693 协议的 RFID 芯片（ NXP ICS20 或 SL2S2002 ）进行卡内数据读写。

本软件使用数据库记录数据。一卡通系统管理者必须配置数据库，并在数据库中插入设备设置，具体方法见 [数据库配置方法](./database/README.md) 。



# 1 安装方法

点击[下载软件安装包](https://github.com/typingbugs/CardManageSystem/releases/download/v0.1.0/CardManageSystem-v0.1.0-setup-amd64.exe)，双击安装包可执行文件，在弹出的请求管理员权限点击确认。

选择安装路径，点击下一步。

<img src="doc\image\installation1.png" alt="installation1" style="zoom:50%;" />

勾选创建桌面快捷方式，点击下一步。

<img src="doc\image\installation2.png" alt="installation2" style="zoom:50%;" />

等待应用安装完成。

<img src="doc\image\installation3.png" alt="installation3" style="zoom:50%;" />

点击完成。

<img src="doc\image\installation4.png" alt="installation4" style="zoom:50%;" />

自动弹出软件界面。

<img src="doc\image\installation5.png" alt="installation5" style="zoom:50%;" />



# 2 使用方法

软件界面左侧为工具栏，点击工具栏中的各个按钮可以切换至不同页面。

软件界面下方为状态栏，显示当前读卡器设置、数据库设置和设备设置。 

## 2.1 配置读卡器和数据库连接

进行开卡等操作前，请按以下步骤配置读卡器和数据库连接。

### Step 1 连接读卡器

点击左侧工具栏的 `设置` 按钮转到设置页面。

在上方 `连接读卡器` 部分输入端口号（可以点击输入框的上下键增加或减少数字）。点击输入框下方的 `连接` 按钮，即可连接读卡器。

若连接成功，窗口下方状态栏左侧的勾选框将显示勾选，同时显示成功连接读卡器的 COM 口号。

<img src="doc\image\setting-step1.png" alt="setting-step1" style="zoom:50%;" />

### Step 2 连接数据库并认证设备名

点击左侧工具栏的 `设置` 按钮转到设置页面。

在下方 `连接数据库` 部分输入数据库的 IP 地址、数据库服务端口、数据库用户密码和设备名，点击下方的 `连接` 按钮，即可连接数据库并认证设备。

若连接成功，窗口下方状态栏右侧的勾选框将显示勾选，同时显示服务器的 IP 地址和服务端口；若设备认证成功，状态栏将显示设备名及其操作权限。

<img src="doc\image\setting-step2.png" alt="setting-step2" style="zoom:50%;" />

## 2.2 开卡

点击左侧工具栏的 `开卡` 按钮转到开卡页面。

> 请注意开卡需要设备有充值权限。

挂失卡复通和挂失卡移资功能也在这里。

首先点击 `查询` 按钮，卡号栏将显示读卡器扫描到的卡号。

**新用户开卡**

如果需要为新用户开卡，在卡号栏选择一张未启用的卡，在 `学/工号` 一栏填入新用户的学/工号，点击开卡。新用户开卡需要填写姓名、密码和二次确认密码进行注册，注册成功后开卡完成。

**挂失卡复通**

如果需要将已挂失的卡复通，在卡号栏选择该卡，点击开卡，在弹出的验证窗口输入用户密码即可将挂失卡复通。

**挂失卡移资**

如果需要将已挂失的卡移资到新卡，在卡号栏选择一张未启用的卡，在 `学/工号` 一栏填入挂失卡绑定的学/工号，点击开卡。在弹出的验证窗口输入用户密码即可将挂失卡移资到新卡。

<img src="doc\image\newCard.png" alt="newCard" style="zoom:50%;" />

## 2.3 充值

点击左侧工具栏的 `充值` 按钮转到充值页面。

> 请注意开卡需要设备有充值权限。

首先输入充值金额，卡内的余额不得超过 9999.99 元。

**远程充值**

在左侧学/工号栏中输入要充值卡绑定的学/工号，点击 `按学/工号充值` 按钮，可以为卡余额远程充值。

**线下充值**

点击右侧卡号栏右侧的 `查询` 按钮，在卡号栏中选择要充值的卡号，点击 `按卡号充值` 按钮，可以为该卡充值。

> 远程充值的交易记录不会存到卡内存储中。

<img src="doc\image\deposit.png" alt="deposit" style="zoom:50%;" />

## 2.4 消费

点击左侧工具栏的 `消费` 按钮转到消费页面。

> 消费只允许线下消费。

首先输入消费金额，不得超过 300.00 元。如果消费金额超过 50.00 元，消费时需要验证用户身份。

点击卡号栏右侧的 `查询` 按钮，选择消费卡号。点击 `消费` 按钮。

如果消费金额超过 50.00 元，需要在弹出的验证窗口中输入用户密码。

<img src="doc\image\consume.png" alt="consume" style="zoom:50%;" />

## 2.5 查询

点击左侧工具栏的 `查询` 按钮转到查询页面。

查询页面右上方显示卡的余额和状态，下方表格中显示该卡的交易记录，包括交易时间、类型（充值或消费）、交易金额、交易后余额、交易设备、交易号。

**按学工号远程查询**

在上方学/工号框中输入学工号，点击 `查询学/工号记录` 按钮，在弹出的验证窗口中输入用户密码，下方表格即可显示用户的所有交易记录，右上方显示卡余额和状态。

**线下查询卡内记录**

点击下方卡号栏右侧 `读卡` 按钮，在卡号栏中选择卡号，点击右侧 `查询卡内记录` ，下方表格即可显示卡内的所有交易记录，右上方显示卡余额和状态。

**线下查询卡绑定用户记录**

点击下方卡号栏右侧 `读卡` 按钮，在卡号栏中选择卡号，点击右侧 `查询所有记录` ，下方表格即可显示卡绑定用户的所有交易记录，右上方显示卡余额和状态。

> 未启用的卡不可被查询。

<img src="doc\image\query.png" alt="query" style="zoom: 50%;" />

## 2.6 挂失

点击左侧工具栏的 `挂失` 按钮转到挂失页面。

在学/工号框中输入学工号，点击 `挂失` 按钮，在弹出的验证窗口中输入用户密码即可挂失。用户的交易记录和卡记录还会保存在数据库中，直到用户将挂失卡移资到新卡。

> 未启用的卡不可被挂失；已挂失的卡不可被重复挂失。

<img src="doc\image\reportLoss.png" alt="reportLoss" style="zoom:50%;" />

## 2.7 退出

点击左侧工具栏的 `退出` 按钮转到退出页面。

点击`确定` 按钮即可退出应用程序。

<img src="doc\image\quitApp.png" alt="quitApp" style="zoom:50%;" />